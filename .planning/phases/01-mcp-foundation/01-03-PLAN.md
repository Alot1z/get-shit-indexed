---
phase: 01-mcp-foundation
plan: 03
type: execute
wave: 3
depends_on: ["01-02"]
files_modified: [".planning/codebase/TOOL-PRIORITY-RULES.md", "workflows/execute-plan.md", "templates/plan-template.md"]
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Tool priority rules enforce MCP > Native tool hierarchy"
    - "GSD workflows use MCP tools instead of native equivalents"
    - "Desktop Commander is primary tool for file/process operations"
    - "Code-Index is primary tool for code search/symbol operations"
    - "Native tools are only used as fallback when MCP unavailable"
    - "80-90% token savings achieved through tool priority enforcement"
  artifacts:
    - path: ".planning/codebase/TOOL-PRIORITY-RULES.md"
      provides: "Comprehensive tool priority rules and enforcement"
      min_lines: 200
    - path: "workflows/execute-plan.md"
      provides: "Updated workflow with MCP tool requirements"
      contains: "tool_requirements section"
    - path: "templates/plan-template.md"
      provides: "Plan template with MCP tool guidance"
      contains: "tool_priority section"
  key_links:
    - from: "All GSD workflows"
      to: "TOOL-PRIORITY-RULES.md"
      via: "reference link"
      pattern: "@tool-priority rules reference"
    - from: "execute-plan.md workflow"
      to: "Subagent execution"
      via: "tool requirements propagation"
      pattern: "MCP tool requirements in all prompts"
    - from: "PLAN.md templates"
      to: "Task execution"
      via: "tool priority enforcement"
      pattern: "MCP-first tool selection in tasks"
---

<objective>
Establish and enforce tool priority rules (Skills > MCP > Native) across all GSD workflows, ensuring 80-90% token efficiency gains.

Purpose: Create a system-wide rule that forces MCP tool usage before falling back to native tools, guaranteeing token efficiency
Output: Comprehensive TOOL-PRIORITY-RULES.md and updated workflow templates with MCP enforcement
</objective>

<execution_context>
@C:\Users\mose\.claude\get-shit-done\workflows\execute-plan.md
@C:\Users\mose\.claude\get-shit-done\templates\summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.planning/phases/01-mcp-foundation/01-01-SUMMARY.md
@.planning/phases/01-mcp-foundation/01-02-SUMMARY.md

@.planning/codebase/ARCHITECTURE.md
@.planning/codebase/STACK.md
@.planning/codebase/INTEGRATIONS.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create comprehensive TOOL-PRIORITY-RULES.md</name>
  <files>.planning/codebase/TOOL-PRIORITY-RULES.md</files>
  <action>Create comprehensive tool priority rules document:

1. Document the mandatory tool priority hierarchy:
   - Level 1: Skill Tools (80-90% token savings, pre-compressed)
   - Level 2: Desktop Commander MCP (50-70% token savings)
   - Level 3: Other MCP Tools (30-50% token savings)
   - Level 4: Native Tools (baseline, 0% savings, LAST RESORT)

2. Create decision tree for tool selection:
   ```
   Need to perform operation?
   ↓
   Is there a Skill for it?
   YES → Use Skill (STOP)
   NO
   ↓
   Is there an MCP tool for it?
   YES → Use MCP tool (STOP)
   NO
   ↓
   Use Native tool (LAST RESORT)
   ```

3. Document operation-specific rules:
   - File Operations: desktop-commander skill > mcp__desktop-commander__* > Read/Write/Edit
   - Process Operations: desktop-commander skill > mcp__desktop-commander__start_process > Bash
   - Code Search: mcp__code-index-mcp__search_code_advanced > Grep
   - File Search: mcp__code-index-mcp__find_files > Glob
   - Symbol Navigation: mcp__code-index-mcp__get_symbol_body > Manual search
   - Code Review: code-review-expert skill > Manual analysis
   - Thinking: sequential-thinking skill > Unstructured reasoning

4. Include examples of CORRECT vs WRONG tool usage:
   - WRONG: Read: {file_path: "/path/to/file.txt"}
   - CORRECT: mcp__desktop-commander__read_file: {path: "/path/to/file.txt"}
   - WRONG: Bash: {command: "grep pattern file.js"}
   - CORRECT: mcp__code-index-mcp__search_code_advanced: {pattern: "query", file_pattern: "*.js"}

5. Document enforcement mechanism:
   - Auto-validation checks tool selection during plan execution
   - Plans that use native tools when MCP available are flagged
   - Training data accumulated from common violations</action>
  <verify>TOOL-PRIORITY-RULES.md exists with complete hierarchy, decision tree, operation-specific rules, and examples</verify>
  <done>Comprehensive tool priority rules document created with clear guidance for MCP-first usage</done>
</task>

<task type="auto">
  <name>Task 2: Add token optimization metrics to TOOL-PRIORITY-RULES.md</name>
  <files>.planning/codebase/TOOL-PRIORITY-RULES.md</files>
  <action>Add token optimization metrics and tracking to TOOL-PRIORITY-RULES.md:

1. Document token savings per tool level:
   - Skill Tools: 80-90% savings (pre-compressed prompts)
   - Desktop Commander MCP: 50-70% savings (efficient protocol)
   - Other MCP Tools: 30-50% savings (standard MCP protocol)
   - Native Tools: 0% savings (baseline)

2. Create token cost comparison table:
   | Operation | Native Cost | MCP Cost | Savings | Best Tool |
   |-----------|-------------|-----------|----------|------------|
   | Read 10 files | ~45K tokens | ~5K tokens | 89% | desktop-commander skill |
   | Search code | ~15K tokens | ~3K tokens | 80% | code-index-mcp |
   | Code review | ~100K tokens | ~10K tokens | 90% | code-review-expert skill |

3. Document batching benefits:
   - Multiple file reads: Use mcp__desktop-commander__read_multiple_files
   - Multiple searches: Batch queries when possible
   - Parallel operations: Use appropriate patterns from TOOL-CHAIN-PATTERNS.md

4. Include monitoring guidance:
   - Track tool usage in agent history
   - Flag native tool usage when MCP available
   - Report compliance rate in summaries</action>
  <verify>TOOL-PRIORITY-RULES.md includes token savings metrics and cost comparison table</verify>
  <done>Token optimization metrics added showing 80-90% savings for MCP tools</done>
</task>

<task type="auto">
  <name>Task 3: Update execute-plan.md with MCP tool requirements</name>
  <files>workflows/execute-plan.md</files>
  <action>Update execute-plan.md workflow to enforce MCP tool usage:

1. Add/update <tool_requirements> section at top of workflow:
   ```xml
   <tool_requirements>
   **MANDATORY: Use MCP tools instead of native tools for all operations.**
   
   - Use `mcp__desktop-commander__read_file` instead of Read
   - Use `mcp__desktop-commander__write_file` instead of Write
   - Use `mcp__code-index-mcp__search_code_advanced` instead of Grep
   - Use `mcp__code-index-mcp__find_files` instead of Glob
   
   Exception: Git operations use Bash tool directly (no MCP git equivalent exists).
   </tool_requirements>
   ```

2. Add MCP tool references throughout workflow steps:
   - Update step instructions to reference MCP tools
   - Add MCP tool examples in step descriptions
   - Include token efficiency notes where relevant

3. Add validation step for tool selection:
   - Check if selected tool follows priority hierarchy
   - Flag if native tool used when MCP available
   - Suggest MCP alternative if violation detected

4. Reference TOOL-PRIORITY-RULES.md for detailed guidance:
   - Add link to comprehensive rules
   - Encourage reference during task execution
   - Include in required reading section</action>
  <verify>execute-plan.md includes <tool_requirements> section and references MCP tools throughout</verify>
  <done>execute-plan.md updated with MCP tool requirements and enforcement guidance</done>
</task>

<task type="auto">
  <name>Task 4: Create plan template with tool priority guidance</name>
  <files>templates/plan-template.md</files>
  <action>Create or update plan template with tool priority guidance:

1. Add <tool_priority> section to template:
   ```xml
   <tool_priority>
   **Tool Selection Hierarchy (MANDATORY):**
   1. Skills FIRST (pre-compressed, maximum efficiency)
   2. Desktop Commander MCP SECOND (high efficiency)
   3. Other MCP Tools THIRD (medium efficiency)
   4. Native Tools LAST (fallback only)
   
   **Quick Reference:**
   - File ops → mcp__desktop-commander__*
   - Code search → mcp__code-index-mcp__*
   - Process ops → mcp__desktop-commander__start_process
   </tool_priority>
   ```

2. Include task-level tool guidance:
   - Each <task> should specify MCP tools in <files> and <action>
   - Examples should use MCP tool syntax
   - Warnings for native tool usage

3. Add verification checklist items:
   - [ ] Task uses MCP tools instead of native equivalents
   - [ ] Tool selection follows priority hierarchy
   - [ ] Token efficiency considerations documented

4. Include deviation tracking for tool violations:
   - If native tool must be used, require justification
   - Track violations in summary
   - Suggest MCP alternative for future</action>
  <verify>templates/plan-template.md includes <tool_priority> section with MCP tool guidance</verify>
  <done>Plan template updated with tool priority guidance for future plans</done>
</task>

</tasks>

<verification>
1. TOOL-PRIORITY-RULES.md created with complete hierarchy and decision tree
2. TOOL-PRIORITY-RULES.md includes token savings metrics and comparison table
3. execute-plan.md updated with <tool_requirements> section
4. Plan template includes <tool_priority> section for future plans
5. All documentation references MCP tools as primary, native as fallback
</verification>

<success_criteria>
1. TOOL-PRIORITY-RULES.md establishes clear Skills > MCP > Native hierarchy
2. Token savings metrics show 80-90% efficiency for MCP tools
3. execute-plan.md enforces MCP tool usage via <tool_requirements>
4. Plan templates guide authors to specify MCP tools
5. Foundation laid for Phase 2 workflow updates with MCP-first approach
</success_criteria>

<output>
After completion, create `.planning/phases/01-mcp-foundation/01-03-SUMMARY.md`
</output>
