# PLAN: 41-01 - Total Codebase Rectification

---
phase: 41
plan: 01
name: Total Codebase Rectification
status: pending
created: 2026-02-18
priority: CRITICAL
estimated_tasks: 12
---

## Objective

Fix all critical audit findings from COMPREHENSIVE-AUDIT-REPORT.md: broken @-references, hardcoded paths, phase conflicts, and orphaned phases.

## Scope

**Source**: COMPREHENSIVE-AUDIT-REPORT.md analysis
**Issues**: 260+ total issues identified

### Critical Findings to Fix

| ID | Category | Count | Description |
|----|----------|-------|-------------|
| 1 | @-References | 79 | Broken doc references |
| 2 | Branding | 54 | GSD→GSI inconsistencies |
| 3 | Paths | 13 | Hardcoded user paths (security risk) |
| 4 | Phase 24 | 3 | Duplicate plans conflict |
| 5 | Phases 28-35 | 8 | Orphaned from ROADMAP |
| 6 | Hooks | 2 | Not registered in settings |

## Tasks

### Wave 1: Critical Security Fixes (Paths)

- [ ] **Task 1**: Scan all files for hardcoded user paths
  - Pattern: `C:/Users/[a-zA-Z]+/`
  - Pattern: `/home/[a-zA-Z]+/`
  - Pattern: `~/.claude/` (except in documentation context)

- [ ] **Task 2**: Replace hardcoded paths with placeholders
  - Use `<USER_HOME>` for user directory references
  - Use `<PROJECT_ROOT>` for project-relative paths
  - Update validation scripts to use placeholders

- [ ] **Task 3**: Verify path replacement completeness
  - Run `grep -r "C:/Users/" --include="*.md" --include="*.js"`
  - Run `grep -r "/home/" --include="*.md" --include="*.js"`
  - Document any intentional exceptions

### Wave 2: Reference Fixes

- [ ] **Task 4**: Catalog all broken @-references
  - Use `grep -r "@\.planning" --include="*.md"`
  - Use `grep -r "@commands" --include="*.md"`
  - Use `grep -r "@lib" --include="*.md"`
  - Generate replacement mapping

- [ ] **Task 5**: Fix @-references to use package-relative paths
  - `.planning/` → `<PROJECT_ROOT>/.planning/`
  - `commands/gsi/` → `<PROJECT_ROOT>/commands/gsi/`
  - Validate each replacement resolves correctly

- [ ] **Task 6**: Verify reference integrity
  - Create reference validation script
  - Run validation across all markdown files
  - Generate fix report

### Wave 3: Phase Consolidation

- [ ] **Task 7**: Analyze Phase 24 duplicates
  - Compare 24-01-PLAN.md vs 24-02-PLAN.md vs 24-universal-prompt-enhancement/
  - Identify unique content in each
  - Create consolidation plan

- [ ] **Task 8**: Consolidate Phase 24 structure
  - Merge unique content into single phase
  - Archive duplicate directories
  - Update ROADMAP.md references

- [ ] **Task 9**: Integrate orphaned Phases 28-35
  - Review phases/28-apex-architecture/ through phases/35-*/
  - Determine integration points in ROADMAP
  - Add to execution flow or archive if deprecated

### Wave 4: Hook Registration

- [ ] **Task 10**: Register pre-tool-use hooks
  - Target: Claude settings.json
  - Hooks: thinking-invoke.js, mcp-enforcer.js
  - Verify hook triggers on tool calls

- [ ] **Task 11**: Register post-tool-use hooks
  - Target: Claude settings.json
  - Hooks: reflection-capture.js
  - Verify hook triggers after tool execution

- [ ] **Task 12**: Validate hook execution
  - Test pre-tool-use fires before Bash
  - Test post-tool-use fires after Read
  - Document hook execution order

## Success Criteria

1. [ ] Zero hardcoded user paths in source code
2. [ ] All 79 @-references fixed or documented
3. [ ] Phase 24 consolidated to single structure
4. [ ] Phases 28-35 integrated or archived
5. [ ] Hooks registered and verified firing
6. [ ] Validation scripts passing

## Dependencies

- COMPREHENSIVE-AUDIT-REPORT.md (source of findings)
- gsi-tools.test.js (validation baseline)

## Notes

- **SECURITY**: Hardcoded paths expose user information
- **FRAGILITY**: Broken references cause runtime errors
- **MAINTAINABILITY**: Duplicate phases cause confusion
