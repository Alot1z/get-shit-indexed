---
phase: 31
plan: 08
title: Performance Benchmarking
wave: 3
depends_on: [31-07]
files_modified:
  - benchmarks/README.md
  - benchmarks/runner.ts
autonomous: true
must_haves:
  truths:
    - Benchmarks defined
    - Results tracked
    - Regressions detected
  artifacts:
    - benchmarks/README.md:60
    - benchmarks/runner.ts:100
---

# 31-08: Performance Benchmarking

## Objective
Create performance benchmarks and tracking system.

## Tasks

### Task 1: Benchmark Runner
**File**: `benchmarks/runner.ts`
**Lines**: ~100

```typescript
import { performance } from 'perf_hooks';

export interface BenchmarkResult {
  name: string;
  iterations: number;
  totalTime: number;
  avgTime: number;
  minTime: number;
  maxTime: number;
  opsPerSecond: number;
}

export class BenchmarkRunner {
  private results: BenchmarkResult[] = [];

  /**
   * Run a benchmark
   */
  async benchmark(
    name: string,
    fn: () => Promise<void> | void,
    iterations: number = 1000
  ): Promise<BenchmarkResult> {
    const times: number[] = [];

    // Warmup
    for (let i = 0; i < 10; i++) {
      await fn();
    }

    // Actual benchmark
    for (let i = 0; i < iterations; i++) {
      const start = performance.now();
      await fn();
      const end = performance.now();
      times.push(end - start);
    }

    const totalTime = times.reduce((a, b) => a + b, 0);
    const avgTime = totalTime / iterations;
    const minTime = Math.min(...times);
    const maxTime = Math.max(...times);
    const opsPerSecond = 1000 / avgTime;

    const result: BenchmarkResult = {
      name,
      iterations,
      totalTime,
      avgTime,
      minTime,
      maxTime,
      opsPerSecond
    };

    this.results.push(result);
    return result;
  }

  /**
   * Get all results
   */
  getResults(): BenchmarkResult[] {
    return [...this.results];
  }

  /**
   * Export results as markdown table
   */
  toMarkdown(): string {
    const lines = [
      '# Benchmark Results',
      '',
      '| Benchmark | Iterations | Avg (ms) | Min (ms) | Max (ms) | Ops/sec |',
      '|-----------|------------|----------|----------|----------|---------|'
    ];

    for (const r of this.results) {
      lines.push(
        `| ${r.name} | ${r.iterations} | ${r.avgTime.toFixed(4)} | ${r.minTime.toFixed(4)} | ${r.maxTime.toFixed(4)} | ${Math.round(r.opsPerSecond)} |`
      );
    }

    return lines.join('\n');
  }

  /**
   * Compare with baseline
   */
  compare(baseline: BenchmarkResult[]): string[] {
    const warnings: string[] = [];

    for (const current of this.results) {
      const base = baseline.find(b => b.name === current.name);
      if (base) {
        const regression = ((current.avgTime - base.avgTime) / base.avgTime) * 100;
        if (regression > 10) {
          warnings.push(`⚠️ ${current.name}: ${regression.toFixed(1)}% slower than baseline`);
        }
      }
    }

    return warnings;
  }
}
```

### Task 2: Benchmarks README
**File**: `benchmarks/README.md`
**Lines**: ~60

```markdown
# GSI Performance Benchmarks

## Running Benchmarks

\`\`\`bash
npm run benchmark
\`\`\`

## Benchmark Categories

### File Operations
- `file-read-small`: Read 1KB file
- `file-read-large`: Read 1MB file
- `file-write-small`: Write 1KB file
- `directory-list`: List 100 files

### Code Search
- `search-simple`: Simple text search
- `search-regex`: Regex pattern search
- `search-indexed`: Indexed code search

### Phase Operations
- `phase-parse`: Parse phase YAML
- `phase-validate`: Validate phase structure

## Baseline Results

Last updated: 2026-02-17

| Benchmark | Baseline (ms) |
|-----------|---------------|
| file-read-small | 0.5 |
| search-indexed | 2.1 |
| phase-parse | 1.8 |

## Regression Detection

Benchmarks that are >10% slower than baseline will trigger warnings.
```

## Output
- Benchmark runner
- Markdown export
- Regression detection

**Phase 31 Complete**
