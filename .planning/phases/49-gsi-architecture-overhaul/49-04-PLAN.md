# Plan 49-04: Command Standardization & Protocol Definition

---
plan: 49-04
phase: 49
created: 2026-02-19
status: planned
tasks: 8
wave: 3
depends_on: [49-01, 49-02]
---

## Objective

Standardize all GSI commands with consistent protocols, ensuring proper tool precedence and context loading.

## Command Categories

### Elementary Commands (Context Fetching)
- `gsi phases list` - List all phases
- `gsi phase get <ID>` - Get specific phase details
- `gsi state snapshot` - Get current project status
- `gsi context generate <target>` - Generate context with --cxml

### Chain Commands (Workflow Execution)
- `gsi execute <phase>` - Execute phase with full context
- `gsi plan <phase>` - Plan phase with research
- `gsi verify <phase>` - Verify phase completion

### Utility Commands
- `gsi hooks install` - Install hooks to settings
- `gsi hooks status` - Check hook registration
- `gsi tools audit` - Audit tool usage compliance

## Tasks

### Wave 1: Elementary Commands (Tasks 1-3)

- [ ] **Task 1**: Standardize `gsi phases list`
  - Add `--type` flag (plans|tasks|all)
  - Add `--format` flag (table|json|cxml)
  - Use only MCP tools internally

- [ ] **Task 2**: Standardize `gsi phase get <ID>`
  - Load phase from ROADMAP.md
  - Include related plans and tasks
  - Support --cxml output format

- [ ] **Task 3**: Standardize `gsi state snapshot`
  - Capture current project state
  - Include milestone progress
  - Generate context with files-to-prompt

### Wave 2: Chain Commands (Tasks 4-6)

- [ ] **Task 4**: Standardize `gsi execute <phase>`
  - Add `--include` flag for context loading
  - Support `--gaps-only` for gap closure
  - Generate pre-execution context with --cxml

- [ ] **Task 5**: Standardize `gsi plan <phase>`
  - Add `--research` flag for domain research
  - Add `--skip-research` to skip research step
  - Support `--cxml` for plan output

- [ ] **Task 6**: Standardize `gsi verify <phase>`
  - Check all success criteria
  - Run plan checker validation
  - Generate verification report

### Wave 3: Protocol Documentation (Tasks 7-8)

- [ ] **Task 7**: Create COMMAND-PROTOCOL.md
  - Document all command signatures
  - Define input/output formats
  - Include examples for each command

- [ ] **Task 8**: Create FORBIDDEN-ACTIONS.md
  - List prohibited native tool usage
  - Provide MCP alternatives for each
  - Document token savings

## Success Criteria

1. All commands standardized with consistent flags
2. --cxml format supported across all commands
3. Context generation integrated with files-to-prompt
4. Protocol documentation complete
5. No native tool usage in command implementations

## Command Protocol Example

```bash
# Standard command format
gsi <domain> <action> [target] [options]

# Examples
gsi phase get 49 --format cxml
gsi execute 49 --include state,roadmap,research
gsi context generate ./lib --output .planning/context/lib.xml
gsi verify 49 --strict
```

## Allowed Tools (Full Cognitive Flow)

```yaml
# File Operations
mcp__desktop-commander__*     # All Desktop Commander tools

# Code Analysis
mcp__code-index-mcp__*        # All Code-Index tools
mcp__CodeGraphContext__*      # Relationship analysis

# Thinking Servers (Cognitive Flow)
mcp__sequential-thinking__*   # Step-by-step reasoning
mcp__tractatusthinking__*     # Logical structure analysis
mcp__debug-thinking__*        # Problem-solution mapping

# External Knowledge
mcp__deepwiki__*              # GitHub repo research
mcp__context7__*              # Library documentation

# Orchestration
Task                          # Subagent spawning
```
