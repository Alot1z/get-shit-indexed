# Plan 49-01: gsi-explorer Agent Implementation

---
plan: 49-01
phase: 49
created: 2026-02-18
status: planned
tasks: 14
wave: 1
---

## Objective

Create `gsi-explorer` agent that analyzes integration gaps across the GSI codebase using ONLY GSI internal tools.

## Source Template

Fork logic from: `commands/gsi/map-codebase.md`

## Core Requirement

**CRITICAL**: Must strictly utilize GSI internal tools (gsi-feature) over native tools.

## Scan Scope

```
lib/
├── thinking/
├── workflow-thinking/
├── prompt-enhancer/     ← Key integration point
├── complexity/          ← Key integration point
├── enhancement/
├── pattern-learning/    ← Key integration point
├── reflection/
└── gsi-integration/     ← Central hub

hooks/
├── pre-tool-use/        ← Enforcement layer
└── post-tool-use/       ← Capture layer

commands/gsi/            ← 30+ command definitions
workflows/               ← 13+ workflow files
agents/                  ← Agent configurations
```

## Gap Analysis Targets

### 1. Disconnected Features/Modules

Check for modules that:
- Exist but are never invoked
- Have no hook connections
- Lack command entry points
- Are documented but not implemented

### 2. Sub-optimal Tool Usage

Identify patterns where:
- Native Read/Write used instead of DesktopCommander
- Native Grep used instead of code-index-mcp
- Manual file operations instead of gsi-tools

### 3. Broken Knowledge Flow

Map the knowledge flow:
```
Pattern Learning ↔ Complexity ↔ Prompt Enhancer
```

Check:
- Does pattern-learning output feed into complexity?
- Does complexity analysis inform prompt-enhancer?
- Does prompt-enhancer use pattern-learning insights?

## Tasks

### Wave 1: Agent Foundation (Tasks 1-5)

- [ ] **Task 1**: Create `commands/gsi/explorer.md` command definition
  - Define allowed-tools (MCP only: DC, CI, CG)
  - Set up execution context with internal tool references
  - Define output format for gap analysis

- [ ] **Task 2**: Fork logic from `map-codebase.md`
  - Copy wave-based spawning pattern
  - Adapt for gap analysis instead of codebase mapping
  - Preserve MCP-only tool restrictions

- [ ] **Task 3**: Define gap detection patterns
  - Pattern: Module exists but no invocations
  - Pattern: Native tool usage in GSI context
  - Pattern: Broken reference chains

- [ ] **Task 4**: Create agent spawn configuration
  - Configure for parallel module scanning
  - Set up result aggregation
  - Define report generation format

- [ ] **Task 5**: Implement `--cxml` output format support
  - Use `files-to-prompt --cxml` for Claude Code XML format
  - Generate combined context files in CXML format
  - Enhance `/gsi:map-codebase` with CXML output option
  - Update workflow context loading to use CXML format

### Wave 2: lib/ Analysis (Tasks 5-8)

- [ ] **Task 5**: Scan `lib/prompt-enhancer/` for integration gaps
  - Check connections to other modules
  - Identify unused enhancement patterns
  - Map input/output contracts

- [ ] **Task 6**: Scan `lib/pattern-learning/` for knowledge flow
  - Verify pattern storage mechanism
  - Check pattern retrieval usage
  - Identify disconnected patterns

- [ ] **Task 7**: Scan `lib/complexity/` for integration status
  - Check if complexity data feeds prompt-enhancer
  - Verify complexity thresholds are used
  - Identify orphan complexity calculations

- [ ] **Task 8**: Scan `lib/gsi-integration/` as central hub
  - Map all integration points
  - Identify missing connections
  - Check hub activation triggers

### Wave 3: Hook Analysis (Tasks 9-11)

- [ ] **Task 9**: Analyze `hooks/pre-tool-use/` enforcement
  - Check for native tool blocking
  - Verify MCP tool routing
  - Identify bypass vulnerabilities

- [ ] **Task 10**: Analyze `hooks/post-tool-use/` capture
  - Check pattern capture from operations
  - Verify knowledge extraction
  - Identify missed capture opportunities

- [ ] **Task 11**: Map hook-to-module connections
  - pre-tool-use → gsi-integration
  - post-tool-use → pattern-learning
  - Identify missing hook connections

### Wave 4: Command & Workflow Analysis (Tasks 12-14)

- [ ] **Task 12**: Scan `commands/gsi/` for tool usage
  - Identify commands using native tools
  - Check for MCP-only compliance
  - Flag commands needing updates

- [ ] **Task 13**: Scan `workflows/` for integration
  - Check workflow-to-module connections
  - Identify orphan workflows
  - Verify context passing between steps

- [ ] **Task 14**: Generate Gap Analysis Report
  - Compile all findings
  - Prioritize by impact
  - Create remediation roadmap

## Success Criteria

1. `gsi-explorer` command exists and runs using only MCP tools
2. All lib/ modules scanned for integration status
3. All hooks analyzed for enforcement gaps
4. Knowledge flow mapped and broken links identified
5. Gap Analysis Report generated with prioritized fixes

## Output Artifacts

- `commands/gsi/explorer.md` - New command definition
- `.planning/phases/49-gsi-architecture-overhaul/GAP-ANALYSIS-REPORT.md`
- `agents/gsi-explorer.json` - Agent configuration

## Allowed Tools

```
mcp__desktop-commander__*     # File operations
mcp__code-index-mcp__*        # Code search
mcp__CodeGraphContext__*      # Relationship analysis
Task                          # Subagent spawning
```

## Forbidden Tools

```
Read      # Use mcp__desktop-commander__read_file
Write     # Use mcp__desktop-commander__write_file
Grep      # Use mcp__code-index-mcp__search_code_advanced
Glob      # Use mcp__code-index-mcp__find_files
Bash      # Use mcp__desktop-commander__start_process
```
