# Plan 49-03: External Repository Research & Integration

---
plan: 49-03
phase: 49
created: 2026-02-18
status: planned
tasks: 12
wave: 3
---

## Objective

Research, clone, and integrate external repositories into GSI package for complete self-containment.

## Target Repositories

### 1. files-to-prompt (CRITICAL)
**Source**: https://github.com/simonw/files-to-prompt
**Purpose**: Generate context files for Claude Code
**Action**: Fork, customize, convert to TypeScript

**Customizations Needed**:
- Add `--cxml` flag for Claude Code XML format
- Add `--gsi` mode for GSI-specific output
- Integrate with GSI command system
- Output to `.planning/context/` structure

**Integration**:
```bash
# Current usage
files-to-prompt ./commands/gsi --cxml -o .planning/context/commands/gsi-commands.xml

# GSI integrated usage
gsi-tools generate-context ./commands/gsi --format cxml
```

### 2. electrobun (Distribution) ✅ VERIFIED WORKING
**Source**: https://github.com/blackboardsh/electrobun
**Purpose**: Cross-platform desktop app bundling
**Status**: CLONED AND TESTED ON WINDOWS 10
**Location**: `C:\github-repos\my-claude-code-repos\electrobun`

**Verified Capabilities**:
- ✅ Cloned with `git clone --recurse-submodules`
- ✅ Installed with `bun install` (91 packages)
- ✅ Built for win32 x64 with MSVC tools
- ✅ CLI working via `npx electrobun init`
- ✅ Test project created successfully

**Use Cases**:
- Bundle GSI as standalone desktop app
- Cross-platform CLI distribution (Windows, macOS, Linux)
- Self-updating GSI installation
- Native UI for GSI tools (terminal, phase explorer, context generator)

**Important Note**: Electrobun is NOT Electron. Different architecture, different APIs.

### 3. superpowers (MCP Tools)
**Source**: https://github.com/obra/superpowers
**Purpose**: MCP server collection
**Components to Extract**:
- `semantic-code-search` - Compare with CI search_code_advanced
- `mcporter` - MCP server porting utilities

### 4. Additional Repositories

| Repository | Purpose | URL |
|------------|---------|-----|
| picoclaw | Lightweight web fetching | https://github.com/sipeed/picoclaw |
| mdream | Workflow enhancement | https://github.com/harlan-zw/mdream |
| agent-lightning | Fast agent spawning | https://github.com/microsoft/agent-lightning |
| PromptChains | Chain patterns | https://github.com/MIATECHPARTNERS/PromptChains |

## Tasks

### Wave 1: files-to-prompt Integration (Tasks 1-4)

- [ ] **Task 1**: Clone files-to-prompt repository
  ```bash
  git clone https://github.com/simonw/files-to-prompt lib/files-to-prompt
  ```

- [ ] **Task 2**: Convert to TypeScript
  - Rename `files_to_prompt.py` → `files-to-prompt.ts`
  - Add type definitions
  - Create `lib/files-to-prompt/index.ts` entry point

- [ ] **Task 3**: Add GSI-specific features
  - `--cxml` flag for Claude Code XML format
  - `--gsi` mode with GSI output structure
  - `--output-dir` for `.planning/context/` targeting
  - `--watch` mode for continuous updates

- [ ] **Task 4**: Integrate with gsi-tools CLI
  ```typescript
  // gsi-tools.ts
  import { generateContext } from './lib/files-to-prompt';
  
  program
    .command('generate-context <path>')
    .option('--format <format>', 'Output format (cxml|md|xml)', 'cxml')
    .option('--output <dir>', 'Output directory', '.planning/context')
    .action(generateContext);
  ```

### Wave 2: MCP Server Bundling (Tasks 5-7)

- [ ] **Task 5**: Audit current MCP server dependencies
  - List all MCP servers GSI depends on
  - Identify which should be bundled vs external
  - Document installation requirements

- [ ] **Task 6**: Create bundled MCP server structure
  ```
  lib/mcp-servers/
  ├── desktop-commander/    # Fork or bundle
  ├── code-index-mcp/       # Fork or bundle
  ├── gsi-custom/           # Custom GSI MCP tools
  │   ├── src/
  │   │   ├── gsi-features.ts
  │   │   ├── prompt-enhancer-mcp.ts
  │   │   └── pattern-learning-mcp.ts
  │   └── package.json
  └── README.md
  ```

- [ ] **Task 7**: Create gsi-custom MCP server
  - Expose GSI internal tools as MCP tools
  - `gsi_analyze_gaps` - Gap analysis
  - `gsi_generate_context` - Context generation
  - `gsi_enhance_prompt` - Prompt enhancement

### Wave 3: TypeScript CLI Tools (Tasks 8-10)

- [ ] **Task 8**: Create unified `gsi-tools` CLI
  ```typescript
  // src/cli/index.ts
  program
    .command('phases list')
    .command('roadmap get-phase <id>')
    .command('state-snapshot')
    .command('generate-context <path>')
    .command('install-hooks')
    .command('init execute-phase <id>')
    .command('init plan-phase <id>');
  ```

- [ ] **Task 9**: Convert Python/JS scripts to TypeScript
  - `scripts/install-hooks.js` → `src/cli/commands/install-hooks.ts`
  - All hooks → TypeScript with types
  - All utilities → TypeScript modules

- [ ] **Task 10**: Build system setup
  - `tsconfig.json` for GSI package
  - Build output to `dist/`
  - Source maps for debugging
  - Type declarations (`.d.ts`)

### Wave 4: Distribution Research (Tasks 11-12)

- [ ] **Task 11**: Research electrobun integration
  - Evaluate for GSI desktop bundling
  - Document build process
  - Test cross-platform output

- [ ] **Task 12**: Create distribution plan
  - NPM package (primary)
  - Desktop app (electrobun)
  - Docker image (optional)
  - Installation documentation

## Success Criteria

1. `files-to-prompt` forked and customized with `--cxml` flag
2. All GSI tools available as TypeScript CLI commands
3. Custom MCP server exposing GSI features
4. Build system produces distributable package
5. Distribution plan documented

## Directory Structure After Integration

```
get-shit-done-code-index/
├── src/
│   ├── cli/
│   │   ├── index.ts              # Main CLI entry
│   │   └── commands/
│   │       ├── phases-list.ts
│   │       ├── generate-context.ts
│   │       └── install-hooks.ts
│   └── lib/
│       ├── files-to-prompt/      # Forked & customized
│       │   ├── index.ts
│       │   └── formatters/
│       │       └── cxml.ts       # Claude Code XML format
│       ├── mcp-servers/
│       │   └── gsi-custom/       # Custom MCP server
│       └── gsi-integration/
├── dist/                         # Built output
├── package.json
└── tsconfig.json
```

## Allowed Tools

```
mcp__desktop-commander__*     # File operations
mcp__deepwiki__*              # Repository research
mcp__context7__*              # Documentation lookup
Task                          # Parallel research agents
```

## Dependencies to Add

```json
{
  "dependencies": {
    "commander": "^12.0.0",
    "glob": "^10.0.0",
    "marked": "^12.0.0",
    "xmlbuilder2": "^3.0.0"
  },
  "devDependencies": {
    "typescript": "^5.0.0",
    "@types/node": "^20.0.0",
    "ts-node": "^10.0.0"
  },
  "bin": {
    "gsi-tools": "./dist/cli/index.js"
  }
}
```
