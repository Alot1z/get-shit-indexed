---
plan: 14-02
phase: 14
name: Add CodeGraphContext to Agents and Commands
created: 2026-02-15
status: pending
estimate: 8 tasks
---

# Plan 14-02: Add CodeGraphContext to Agents and Commands

## Goal
Add CodeGraphContext (CG) tools to agent and command files for relationship analysis capabilities.

## Context
- **CG tools available:** 15+ tools for relationship analysis
- **Current CG usage:** 88 references (under-utilized)
- **Target files:** Agents (11), Commands (29)

## Tasks

### Task 1: Add CG to Agent allowed-tools
**File:** `agents/gsi-*.md` (11 files)
- [ ] Add `mcp__CodeGraphContext__analyze_code_relationships`
- [ ] Add `mcp__CodeGraphContext__find_code`
- [ ] Add `mcp__CodeGraphContext__get_repository_stats`
- [ ] Add usage comment: "Use CG for relationship analysis before file operations"

### Task 2: Update GSI-executor Agent
**File:** `agents/gsi-executor.md`
- [ ] Add CG relationship check before code modifications
- [ ] Include impact analysis step in execution flow
- [ ] Reference neo4j://localhost:7687 connection

### Task 3: Update GSI-debugger Agent
**File:** `agents/gsi-debugger.md`
- [ ] Add CG for tracing bug propagation paths
- [ ] Use find_callers to identify affected code
- [ ] Use analyze_code_relationships for dependency tracking

### Task 4: Update GSI-planner Agent
**File:** `agents/gsi-planner.md`
- [ ] Add CG for architecture understanding
- [ ] Use class_hierarchy for component relationships
- [ ] Include CG step in planning process

### Task 5: Add CG to Command allowed-tools
**File:** `commands/gsi/*.md` (29 files)
- [ ] Add CG tools to relevant commands
- [ ] Add code_index_mcp section documenting CG usage
- [ ] Priority: map-codebase, plan-phase, debug, verify-work

### Task 6: Create CG Usage Reference
**File:** `references/codegraphcontext-usage.md` (NEW)
- [ ] Document all 15+ CG tools
- [ ] Include usage patterns for each tool type
- [ ] Add Mermaid diagram of CG workflow

### Task 7: Update mcp-enforcer for CG
**File:** `hooks/mcp-enforcer.js`
- [ ] Add CG tools to allowed list
- [ ] Add recommendation for CG before structural changes
- [ ] Log suggestion when Grep used for relationship analysis

### Task 8: Commit Changes
**File:** All modified files
- [ ] Stage all changes
- [ ] Commit with message: "feat(14-02): add CodeGraphContext to agents and commands"

## Verification

### Success Criteria
- [ ] All 11 agents have CG in allowed-tools
- [ ] All 29 commands have relevant CG tools
- [ ] CG usage reference document exists
- [ ] mcp-enforcer recognizes CG tools

### Test Commands
```bash
# Verify CG in agents
grep -l "CodeGraphContext" agents/gsi-*.md | wc -l
# Expected: 11

# Verify CG in commands
grep -l "CodeGraphContext" commands/gsi/*.md | wc -l
# Expected: 29
```

## Dependencies
- Plan 14-01 (read_multiple_files)

## Notes
- CG server must be running (neo4j://localhost:7687)
- Add CG comments to guide usage patterns
- Some commands may not need CG (e.g., yolo, settings)
