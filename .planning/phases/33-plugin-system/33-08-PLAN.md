---
phase: 33
plan: 08
title: Plugin Testing
wave: 3
depends_on: [33-07]
files_modified:
  - lib/gsi-core/plugins/plugin-tester.ts
  - docs/plugins/testing.md
autonomous: true
must_haves:
  truths:
    - Plugins testable
    - Test utilities provided
    - Documentation available
  artifacts:
    - lib/gsi-core/plugins/plugin-tester.ts:100
    - docs/plugins/testing.md:80
---

# 33-08: Plugin Testing

## Objective
Create testing utilities for plugin development.

## Tasks

### Task 1: Plugin Tester
**File**: `lib/gsi-core/plugins/plugin-tester.ts`
**Lines**: ~100

```typescript
import type { GSIPlugin, PluginContext } from './types.js';
import { PluginSandbox } from './sandbox.js';

export interface TestResult {
  passed: boolean;
  tests: Array<{ name: string; passed: boolean; error?: string }>;
  duration: number;
}

export class PluginTester {
  private sandbox: PluginSandbox;

  constructor() {
    this.sandbox = new PluginSandbox({ timeout: 5000 });
  }

  /**
   * Run plugin tests
   */
  async test(plugin: GSIPlugin): Promise<TestResult> {
    const startTime = Date.now();
    const tests: Array<{ name: string; passed: boolean; error?: string }> = [];

    // Test 1: Plugin initializes
    try {
      await this.testInit(plugin);
      tests.push({ name: 'init', passed: true });
    } catch (error) {
      tests.push({ name: 'init', passed: false, error: String(error) });
    }

    // Test 2: Plugin exports required methods
    try {
      this.testExports(plugin);
      tests.push({ name: 'exports', passed: true });
    } catch (error) {
      tests.push({ name: 'exports', passed: false, error: String(error) });
    }

    // Test 3: Plugin cleans up
    try {
      await this.testCleanup(plugin);
      tests.push({ name: 'cleanup', passed: true });
    } catch (error) {
      tests.push({ name: 'cleanup', passed: false, error: String(error) });
    }

    const duration = Date.now() - startTime;
    const passed = tests.every(t => t.passed);

    return { passed, tests, duration };
  }

  /**
   * Test plugin initialization
   */
  private async testInit(plugin: GSIPlugin): Promise<void> {
    const context: PluginContext = {
      pluginName: 'test',
      fs: {},
      fetch: async () => new Response(),
      log: () => {}
    };

    await plugin.init(context);
  }

  /**
   * Test plugin exports
   */
  private testExports(plugin: GSIPlugin): void {
    if (typeof plugin.init !== 'function') {
      throw new Error('Plugin must export init()');
    }
    if (typeof plugin.cleanup !== 'function') {
      throw new Error('Plugin must export cleanup()');
    }
  }

  /**
   * Test plugin cleanup
   */
  private async testCleanup(plugin: GSIPlugin): Promise<void> {
    await plugin.cleanup();
  }

  /**
   * Create mock context
   */
  createMockContext(overrides: Partial<PluginContext> = {}): PluginContext {
    return {
      pluginName: 'test',
      fs: {
        readFile: async () => Buffer.from(''),
        writeFile: async () => {}
      },
      fetch: async () => new Response(),
      log: () => {},
      ...overrides
    };
  }
}
```

### Task 2: Testing Documentation
**File**: `docs/plugins/testing.md`
**Lines**: ~80

```markdown
# Plugin Testing Guide

## Overview

GSI provides testing utilities to ensure plugin quality.

## Basic Test

\`\`\`typescript
import { PluginTester } from 'gsi/plugins';
import myPlugin from './index';

const tester = new PluginTester();
const result = await tester.test(myPlugin);

if (result.passed) {
  console.log('All tests passed!');
} else {
  console.log('Failed tests:', result.tests.filter(t => !t.passed));
}
\`\`\`

## Test Categories

### 1. Init Test
Verifies plugin initializes without errors.

### 2. Exports Test
Verifies plugin exports required methods.

### 3. Cleanup Test
Verifies plugin cleans up resources.

## Mock Context

Create mock context for unit testing:

\`\`\`typescript
const context = tester.createMockContext({
  log: (msg) => console.log('[TEST]', msg)
});
\`\`\`

## Best Practices

1. Test all plugin lifecycle methods
2. Use mock context for isolation
3. Test error handling paths
4. Verify cleanup releases resources
```

## Output
- Plugin tester utility
- Testing documentation
- Mock context creation

**Phase 33 Complete**
