# Plan 19-02: Cognitive Enhancement Engine

**Phase:** 19 (Prompt Enhancer)
**Depends on:** Plan 19-01 (Command Interception Layer)
**Status:** Ready for execution

## Objective

Implement the core enhancement logic using the Three-Layer Cognitive Flow (Tractatus+CI, Sequential+CG, Debug+DC).

## Architecture

```
Original Prompt → Phase 1 (Tractatus+CI) → Phase 2 (Sequential+CG) → Phase 3 (Debug+DC) → Enhanced Prompt
                        ↓                          ↓                        ↓
                  Intent Analysis          Enhancement Plan         Pattern Application
                  Context Search           Dependency Check         History Learning
```

## Tasks

### Task 1: Create enhancePrompt main function
- [ ] Orchestrate three-phase enhancement flow
- [ ] Implement graceful degradation (if one phase fails, continue)
- [ ] Return `{ enhancedPrompt, score, phases: [...] }`
- [ ] Add timing metrics for performance tracking

### Task 2: Implement Phase 1 - Intent Analysis (Tractatus+CI)
- [ ] Use Tractatus thinking to decompose user intent into atomic propositions
- [ ] Use Code-Index MCP to search relevant context files
- [ ] Extract: user_goal, context_needed, constraints_identified
- [ ] Output structured intent object

### Task 3: Implement Phase 2 - Enhancement Planning (Sequential+CG)
- [ ] Use Sequential thinking to plan enhancement steps
- [ ] Use CodeGraph MCP to check command dependencies
- [ ] Identify: missing_context, clarification_needed, suggested_additions
- [ ] Output enhancement plan with priorities

### Task 4: Implement Phase 3 - Pattern Application (Debug+DC)
- [ ] Query Debug thinking for similar past prompts
- [ ] Use Desktop Commander to read enhancement patterns from `patterns.json`
- [ ] Apply learned improvements based on success history
- [ ] Output pattern application results

### Task 5: Create assembleEnhancedPrompt function
- [ ] Combine original prompt with intent analysis
- [ ] Add detected context and requirements
- [ ] Include learned patterns if applicable
- [ ] Format with clear sections

### Task 6: Implement enhancement scoring
- [ ] Calculate enhancement quality score (0-10)
- [ ] Score based on: context added, clarity improved, requirements detected
- [ ] Skip enhancement if score < 3 (simple commands don't need enhancement)
- [ ] Log scores for learning

### Task 7: Create formatEnhancedPrompt function
- [ ] Format structure: `## Context`, `## Detected Requirements`, `## Enhancement Notes`
- [ ] Preserve original user intent
- [ ] Add helpful context without changing meaning
- [ ] Include confidence level

### Task 8: Export enhancer functions
- [ ] Export `enhancePrompt`, `assembleEnhancedPrompt`, `formatEnhancedPrompt`
- [ ] Export `calculateEnhancementScore`
- [ ] Add to `lib/prompt-enhancer/index.js`

## Files to Create

| File | Purpose |
|------|---------|
| `lib/prompt-enhancer/enhancer.js` | Core enhancement logic |
| `lib/prompt-enhancer/patterns.json` | Initial patterns file |

## Integration with Phase 17

| Phase 17 Module | Enhancement Usage |
|-----------------|-------------------|
| `cognitive-flow.js` | Three-phase orchestration pattern |
| `tractatus-ci-phase.js` | Intent analysis with Tractatus+CI |
| `sequential-cg-phase.js` | Enhancement planning with Sequential+CG |
| `debug-dc-phase.js` | Pattern application with Debug+DC |

## Verification

- [ ] Enhanced prompts include context and detected requirements
- [ ] Simple commands (score < 3) pass through unchanged
- [ ] All three phases execute with graceful degradation
- [ ] Scoring system works correctly

## Example Enhancement

**Input:** `/gsi:plan-phase 19`

**Output:**
```
/gsi:plan-phase 19

## Context
Phase 19 implements the Prompt Enhancer system with:
- Command interception layer
- Cognitive enhancement engine
- User confirmation UI
- Pattern learning integration

## Detected Requirements
- Create 4 plan files in .planning/phases/19-prompt-enhancer/
- Integrate with Phase 17 complexity system
- Support YOLO mode for auto-approval

## Enhancement Notes
- Added phase context from ROADMAP.md
- Detected dependency on Phase 17 cognitive architecture
```

---

*Plan created: 2026-02-15*
