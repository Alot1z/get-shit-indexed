# Plan 19-04: Pattern Learning Integration

**Phase:** 19 (Prompt Enhancer)
**Depends on:** Plan 19-02 (Cognitive Enhancement Engine)
**Status:** Ready for execution

## Objective

Capture enhancement history and learn from patterns to improve future enhancements.

## Architecture

```
Enhancement Complete → Store Pattern → Debug Thinking Graph
                            ↓
                      enhancement-history.json
                            ↓
                    Future Enhancements Query Patterns
```

## Tasks

### Task 1: Create enhancement-history.json
- [ ] Initialize with empty patterns array
- [ ] Add statistics object
- [ ] Store in `.planning/` directory

### Task 2: Implement recordEnhancement function
- [ ] Store original prompt
- [ ] Store enhanced prompt
- [ ] Store command type
- [ ] Store enhancement score
- [ ] Store outcome (accepted/edited/rejected)

### Task 3: Create queryEnhancementPatterns function
- [ ] Query Debug thinking for similar prompts
- [ ] Filter by command type
- [ ] Return top matches with similarity scores

### Task 4: Implement extractPattern function
- [ ] Analyze enhancement diff
- [ ] Extract reusable pattern (what was added/changed)
- [ ] Store pattern with success rate

### Task 5: Create adaptEnhancementThreshold function
- [ ] Analyze success rate of enhancements
- [ ] Adjust minimum enhancement score threshold
- [ ] Learn from user rejections

### Task 6: Integrate with enhancer.js
- [ ] Apply learned patterns in Phase 3 of cognitive enhancement
- [ ] Use history for scoring adjustments
- [ ] Update patterns after each enhancement

## Files to Create/Modify

| File | Purpose |
|------|---------|
| `.planning/enhancement-history.json` | Enhancement pattern storage |
| `lib/prompt-enhancer/patterns.json` | Populated by learning |

## Learning Data Structure

```json
{
  "patterns": [
    {
      "id": "pattern-001",
      "command": "plan-phase",
      "originalPrompt": "/gsi:plan-phase 17",
      "enhancedPrompt": "/gsi:plan-phase 17\nContext: Phase 17 implements...",
      "pattern": "Add phase context and detected requirements",
      "successRate": 0.92,
      "usageCount": 15
    }
  ],
  "statistics": {
    "totalEnhancements": 50,
    "avgImprovement": 0.35,
    "topPatterns": ["context-addition", "requirement-detection"]
  }
}
```

## Verification

- [ ] Patterns stored after each enhancement
- [ ] Query returns relevant historical patterns
- [ ] Threshold adapts based on success rate
- [ ] Learning improves enhancement quality over time

---

*Plan created: 2026-02-15*
