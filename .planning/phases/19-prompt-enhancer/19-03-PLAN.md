# Plan 19-03: User Confirmation UI

**Phase:** 19 (Prompt Enhancer)
**Depends on:** Plan 19-01 (Command Interception), Plan 19-02 (Cognitive Enhancement)
**Status:** Ready for execution

## Objective

Implement the confirmation layer that shows enhanced prompts and respects YOLO mode.

## Architecture

```
Enhanced Prompt → YOLO Check → Auto-Approve? → Execute
                      ↓ No
                Show Enhancement
                      ↓
                User Decision → Approve / Edit / Cancel
                      ↓
                Execute / Modify / Abort
```

## Tasks

### Task 1: Implement isYoloMode function
- [ ] Read `.planning/config.json`
- [ ] Check `mode === "yolo"`
- [ ] Return boolean

### Task 2: Create displayEnhancement function
- [ ] Format enhanced prompt for display
- [ ] Show diff-style comparison (original vs enhanced)
- [ ] Highlight added context and detected requirements
- [ ] Include confidence score

### Task 3: Implement promptForConfirmation function
- [ ] Present options: [A]pprove, [E]dit, [C]ancel, [S]kip enhancement
- [ ] Wait for user input
- [ ] Return user choice

### Task 4: Create handleUserChoice function
- [ ] Process user decision
- [ ] approve → return enhanced prompt
- [ ] edit → open editor
- [ ] cancel → abort execution
- [ ] skip → return original prompt

### Task 5: Implement editInEditor function
- [ ] Open enhanced prompt in default editor
- [ ] Allow manual editing
- [ ] Return edited content

### Task 6: Create confirmEnhancement main function
- [ ] Orchestrate full confirmation flow
- [ ] Integrate YOLO bypass
- [ ] Return final prompt for execution

## Files to Create

| File | Purpose |
|------|---------|
| `lib/prompt-enhancer/confirmation.js` | User confirmation logic |

## YOLO Mode Integration

```javascript
async function confirmEnhancement(enhancedPrompt, originalPrompt) {
  const config = JSON.parse(await dc.read_file({ path: ".planning/config.json" }));
  if (config.mode === "yolo") {
    return { approved: true, prompt: enhancedPrompt, autoApproved: true };
  }
  // ... show confirmation UI
}
```

## Verification

- [ ] YOLO mode auto-approves without display
- [ ] Non-YOLO shows enhancement diff
- [ ] All four options work correctly (Approve/Edit/Cancel/Skip)

---

*Plan created: 2026-02-15*
