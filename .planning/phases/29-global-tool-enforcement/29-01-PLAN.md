---
phase: 29
plan: 01
type: implementation
wave: 1
depends_on: []
files_modified:
  - lib/gsi-install/installer.js
  - lib/gsi-install/installer.ts
  - bin/gsi-install.js
autonomous: true
must_haves:
  truths:
    - User can run `gsi install --global` to install to ~/.claude/
    - User can run `gsi install --project` to install to ./.claude/
    - Installation copies all rules, workflows, and MCP requirements
  artifacts:
    - lib/gsi-install/installer.ts:150
    - bin/gsi-install.js:30
  key_links:
    - from: bin/gsi-install.js
      to: lib/gsi-install/installer.ts
      via: CLI argument parsing
---

# 29-01: Installation System (Global vs Project)

## Objective
Create installation system that deploys GSI rules to either global (~/.claude/) or project (./.claude/) locations.

## Context
@.planning/STATE.md
@.planning/ROADMAP.md

## Tasks

### Task 1: Installer Core
**File**: `lib/gsi-install/installer.ts`
**Action**: Create installation logic

```typescript
interface InstallOptions {
  global: boolean;
  force: boolean;
  verbose: boolean;
}

interface InstallResult {
  success: boolean;
  location: 'global' | 'project';
  filesCopied: string[];
  errors: string[];
}

const GSI_FILES = [
  'rules/tool-priority.md',
  'rules/auto-validation.md',
  'rules/code-review.md',
  'workflows/plan-phase.md',
  'workflows/execute-plan.md',
  'agents/gsi-*.md',
  'commands/gsi/*.md',
  'references/mcp-tool-reference.md',
];

export async function installGSI(options: InstallOptions): Promise<InstallResult> {
  const targetDir = options.global 
    ? path.join(os.homedir(), '.claude')
    : path.join(process.cwd(), '.claude');

  const filesCopied: string[] = [];
  const errors: string[] = [];

  for (const file of GSI_FILES) {
    try {
      const source = path.join(GSI_ROOT, file);
      const target = path.join(targetDir, file);
      
      await fs.ensureDir(path.dirname(target));
      await fs.copy(source, target, { overwrite: options.force });
      
      filesCopied.push(file);
    } catch (error) {
      errors.push(`${file}: ${error.message}`);
    }
  }

  return {
    success: errors.length === 0,
    location: options.global ? 'global' : 'project',
    filesCopied,
    errors
  };
}
```

**Verify**:
- [ ] Installer creates correct target directory
- [ ] All GSI files are copied
- [ ] Error handling works

**Done**:
- [ ] installer.ts written
- [ ] Type definitions complete
- [ ] File list comprehensive

### Task 2: CLI Entry Point
**File**: `bin/gsi-install.js`
**Action**: Create CLI wrapper

```javascript
#!/usr/bin/env node
const { installGSI } = require('../lib/gsi-install/installer');

const args = process.argv.slice(2);
const options = {
  global: args.includes('--global') || args.includes('-g'),
  force: args.includes('--force') || args.includes('-f'),
  verbose: args.includes('--verbose') || args.includes('-v')
};

if (!options.global && !args.includes('--project')) {
  console.log('Usage: gsi install [--global | --project] [--force] [--verbose]');
  process.exit(1);
}

installGSI(options).then(result => {
  if (result.success) {
    console.log(`✓ GSI installed to ${result.location} location`);
    console.log(`  Files copied: ${result.filesCopied.length}`);
  } else {
    console.error('✗ Installation failed:');
    result.errors.forEach(e => console.error(`  - ${e}`));
    process.exit(1);
  }
});
```

**Verify**:
- [ ] CLI parses arguments correctly
- [ ] Help text displays
- [ ] Exit codes correct

**Done**:
- [ ] bin/gsi-install.js created
- [ ] Made executable
- [ ] Help works

### Task 3: Package.json Updates
**File**: `package.json`
**Action**: Add bin entry

```json
{
  "bin": {
    "gsi": "./bin/gsi-install.js",
    "gsi-install": "./bin/gsi-install.js"
  }
}
```

**Done**:
- [ ] bin entry added
- [ ] npm link works

### Task 4: Install Verification
**Action**: Test installation

**Verify**:
- [ ] `gsi install --global` works
- [ ] `gsi install --project` works
- [ ] Files appear in correct locations

## Output

Working installation system with global/project support.

**Next**: 29-02 - Tool Priority Rules System
