---
phase: 29
plan: 04
type: implementation
wave: 2
depends_on: [29-01, 29-02]
files_modified:
  - lib/gsi-config/config.ts
  - lib/gsi-config/sync.ts
autonomous: true
must_haves:
  truths:
    - Global config stored in ~/.claude/gsi-config.json
    - Project config stored in ./.claude/gsi-config.json
    - Sync keeps configs aligned
  artifacts:
    - lib/gsi-config/config.ts:100
    - lib/gsi-config/sync.ts:80
---

# 29-04: Configuration Sync System

## Objective
Create configuration system that syncs global and project settings.

## Tasks

### Task 1: Config Manager
**File**: `lib/gsi-config/config.ts`
**Action**: Manage GSI configuration

```typescript
export interface GSIConfig {
  version: string;
  toolPriority: 'skill' | 'mcp' | 'native';
  enforcementLevel: 'strict' | 'warn' | 'off';
  mcpServers: {
    'desktop-commander': boolean;
    'code-index-mcp': boolean;
  };
  tokenOptimization: boolean;
}

const DEFAULT_CONFIG: GSIConfig = {
  version: '1.0.0',
  toolPriority: 'skill',
  enforcementLevel: 'warn',
  mcpServers: {
    'desktop-commander': true,
    'code-index-mcp': true
  },
  tokenOptimization: true
};

export async function loadConfig(scope: 'global' | 'project'): Promise<GSIConfig> {
  const configPath = scope === 'global'
    ? path.join(os.homedir(), '.claude', 'gsi-config.json')
    : path.join(process.cwd(), '.claude', 'gsi-config.json');
    
  try {
    const content = await fs.readFile(configPath, 'utf-8');
    return { ...DEFAULT_CONFIG, ...JSON.parse(content) };
  } catch {
    return DEFAULT_CONFIG;
  }
}
```

**Done**:
- [ ] Config interface defined
- [ ] Load/save works
- [ ] Defaults sensible

### Task 2: Sync System
**File**: `lib/gsi-config/sync.ts`
**Action**: Sync global and project configs

```typescript
export async function syncConfigs(): Promise<{
  global: GSIConfig;
  project: GSIConfig;
  merged: GSIConfig;
}> {
  const global = await loadConfig('global');
  const project = await loadConfig('project');
  
  // Project overrides global
  const merged = { ...global, ...project };
  
  return { global, project, merged };
}
```

**Done**:
- [ ] Sync logic works
- [ ] Merge correct

## Output

Configuration sync system.

**Next**: 29-05 - CLI Installation Commands
