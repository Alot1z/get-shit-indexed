# Phase 20-06: Install Location Detection System

## Objective
Create intelligent install location detection that adjusts storage paths based on whether GSI is installed globally or project-level.

## Problem Analysis

**Current State:**
- GSI can be installed globally (~/.claude/get-shit-indexed/)
- GSI can be installed project-level (./gsi/)
- No automatic detection of install context
- Hardcoded paths don't adapt to context

**Solution:**
Create detection system that determines install location and adjusts all paths accordingly.

## Tasks

### Task 1: Create Install Detector Module
```
<task>
Create module to detect GSI install location.

1. Create lib/context/install-detector.js
2. Implement detectInstallLocation():
   - Check if running from ~/.claude/get-shit-indexed/
   - Check if .gsi/ exists in current directory
   - Check GSI_INSTALL_TYPE env var
   - Default to project-level if uncertain
3. Return: { type: 'global'|'project', basePath: string }
4. Add caching for performance
5. Export for use across GSI
</task>

<files>
lib/context/install-detector.js
</files>

<acceptance>
- Detection works for global and project
- Caching implemented
- Exported for use
</acceptance>
```

### Task 2: Create Context-Aware Path Resolver
```
<task>
Create path resolver that adjusts based on install location.

1. Create lib/context/path-resolver.js
2. Implement resolvePath(relativePath):
   - Get install location from detector
   - Global: ~/.claude/get-shit-indexed/.planning/...
   - Project: <project>/.planning/...
3. Implement resolveDataPath(dataType):
   - patterns: .planning/patterns/
   - metrics: .planning/*-metrics.json
   - reflections: ~/.debug-thinking-mcp/ (always global)
4. Add path validation
5. Export unified API
</task>

<files>
lib/context/path-resolver.js
</files>

<acceptance>
- Path resolution works for both contexts
- All data types supported
- Validation implemented
</acceptance>
```

### Task 3: Update Pattern Learning Storage
```
<task>
Update pattern learning to use context-aware paths.

1. Update lib/pattern-learning/storage.js
2. Import path-resolver
3. Replace hardcoded paths with resolveDataPath('patterns')
4. Test with both install types
5. Ensure data persistence works
</task>

<files>
lib/pattern-learning/storage.js
</files>

<acceptance>
- Pattern storage uses context-aware paths
- Works in both contexts
- Data persists correctly
</acceptance>
```

### Task 4: Update Thinking Metrics Storage
```
<task>
Update thinking metrics to use context-aware paths.

1. Update lib/thinking/metrics.js
2. Import path-resolver
3. Replace hardcoded .planning/ with resolveDataPath('metrics')
4. Update command-thinking/metrics.js similarly
5. Test metrics persistence in both contexts
</task>

<files>
lib/thinking/metrics.js
lib/command-thinking/metrics.js
</files>

<acceptance>
- Thinking metrics use context-aware paths
- Command thinking metrics updated
- Both contexts work
</acceptance>
```

### Task 5: Update GSI-Tools CLI
```
<task>
Update gsi-tools.js to use install detection.

1. Update bin/gsi-tools.js
2. Add --install-info command to show detected context
3. Use path-resolver for all file operations
4. Add --force-global and --force-project flags for testing
5. Document in help output
</task>

<files>
bin/gsi-tools.js
</files>

<acceptance>
- CLI shows install info
- Context-aware paths used
- Force flags work for testing
</acceptance>
```

### Task 6: Create Context Documentation
```
<task>
Document install location detection and context-aware paths.

1. Create .planning/codebase/INSTALL-CONTEXT.md
2. Document:
   - How detection works
   - Global vs project paths
   - Data storage locations
   - How to override detection
3. Add troubleshooting section
4. Add examples for both contexts
</task>

<files>
.planning/codebase/INSTALL-CONTEXT.md
</files>

<acceptance>
- Documentation complete
- Troubleshooting included
- Examples provided
</acceptance>
```

### Task 7: Test Context System
```
<task>
Test install detection in both contexts.

1. Test from ~/.claude/get-shit-indexed/ (global)
2. Test from project directory (project)
3. Verify correct paths resolved
4. Verify data stored in correct locations
5. Document test results
</task>

<files>
.planning/phases/20-thinking-integration-completion/20-06-VERIFICATION.md
</files>

<acceptance>
- Global context detected correctly
- Project context detected correctly
- Paths resolve correctly
- Data persists in correct locations
</acceptance>
```

## Verification

**Must Have:**
- [ ] Install detector works
- [ ] Path resolver works
- [ ] Pattern learning uses context paths
- [ ] Thinking metrics use context paths
- [ ] CLI shows install info

## Estimated Duration
12-15 minutes (7 tasks)

## Dependencies
- Phase 20-03 (PostToolUse Reflection) - uses storage paths
- Phase 22-01 (Pattern Learning) - uses storage paths
