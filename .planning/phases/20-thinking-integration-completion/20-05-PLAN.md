# Phase 20-05: Workflow Thinking Phases

## Objective
Integrate thinking phases into all GSI workflows so thinking happens at each workflow step using appropriate thinking servers.

## Problem Analysis

**Current State:**
- 30 workflow files exist in workflows/
- Workflows have no thinking_phase sections
- Workflow steps execute without cognitive enhancement
- No learning capture between workflow steps

**Root Cause:**
Phase 15 planned thinking workflow sections but they were never implemented. The thinking servers exist but are not called during workflow execution.

## Tasks

### Task 1: Create Workflow Thinking Template
```
<task>
Create a reusable template for thinking phases in workflows.

1. Create templates/workflow-thinking.md
2. Define thinking phase structure:
   ## Thinking Phase
   <thinking>
   <server>tractatus|sequential|debug</server>
   <prompt>Context-aware prompt</prompt>
   <expected_output>What to look for</expected_output>
   <timeout>3000</timeout>
   </thinking>
3. Add thinking phase types:
   - PRE_WORKFLOW: Before workflow starts
   - PRE_STEP: Before each step
   - POST_STEP: After each step
   - POST_WORKFLOW: After workflow completes
4. Document usage examples
5. Add to template registry
</task>

<files>
templates/workflow-thinking.md
</files>

<acceptance>
- Template created with all phase types
- Structure documented
- Examples provided
- Added to registry
</acceptance>
```

### Task 2: Update Plan-Phase Workflow
```
<task>
Update the plan-phase workflow with thinking phases at each step.

1. Read workflows/plan-phase.md
2. Add PRE_WORKFLOW thinking:
   - Use Tractatus for phase structure analysis
   - Analyze phase goals and requirements
3. Add PRE_STEP thinking for each major step:
   - Research → Sequential for research direction
   - Planning → Tractatus for plan structure
   - Verification → Debug for plan validation
4. Add POST_STEP reflection after each step
5. Add POST_WORKFLOW reflection with debug-thinking storage
</task>

<files>
workflows/plan-phase.md
</files>

<acceptance>
- plan-phase has thinking at all phases
- Appropriate servers used per step
- Reflection captured
</acceptance>
```

### Task 3: Update Execute-Phase Workflow
```
<task>
Update the execute-phase workflow with thinking phases at each step.

1. Read workflows/execute-phase.md
2. Add PRE_WORKFLOW thinking:
   - Use Sequential for execution planning
   - Identify potential issues
3. Add PRE_STEP thinking:
   - Task understanding (Tractatus)
   - Risk assessment (Debug)
4. Add POST_STEP reflection:
   - Capture learnings
   - Store in debug-thinking graph
5. Add POST_WORKFLOW summary reflection
</task>

<files>
workflows/execute-phase.md
</files>

<acceptance>
- execute-phase has thinking at all phases
- Risk assessment included
- Learnings captured in graph
</acceptance>
```

### Task 4: Update Research-Phase Workflow
```
<task>
Update the research-phase workflow with thinking phases.

1. Read workflows/research-phase.md
2. Add PRE_WORKFLOW thinking:
   - Use Sequential for research direction
   - Identify key questions
3. Add thinking for research steps:
   - Web search → Sequential for query optimization
   - Code analysis → Tractatus for structure
   - Synthesis → Tractatus for logical organization
4. Add POST_WORKFLOW reflection:
   - What was learned?
   - What gaps remain?
</task>

<files>
workflows/research-phase.md
</files>

<acceptance>
- research-phase has thinking
- Query optimization included
- Learning synthesis captured
</acceptance>
```

### Task 5: Update Verification Workflows
```
<task>
Update verification workflows with thinking phases.

1. Update workflows/verify-plan.md:
   - Add Tractatus for plan structure verification
   - Add Debug for plan-goal alignment check
2. Update workflows/verify-work.md:
   - Add Debug for issue detection
   - Add Sequential for verification process
3. Update workflows/diagnose-issues.md:
   - Add Debug thinking for root cause analysis
   - Add hypothesis generation
4. Ensure all verification has POST reflection
</task>

<files>
workflows/verify-plan.md
workflows/verify-work.md
workflows/diagnose-issues.md
</files>

<acceptance>
- Verification workflows have thinking
- Debug thinking for issues
- Root cause analysis included
</acceptance>
```

### Task 6: Update Remaining Workflows
```
<task>
Update remaining workflows with appropriate thinking phases.

1. Update workflows/map-codebase.md:
   - Sequential for agent spawn decisions
   - Tractatus for architecture analysis
2. Update workflows/check-health.md:
   - Debug for health issue detection
3. Update workflows/yolo-mode.md:
   - Lightweight Sequential for rapid decisions
4. Update workflows/manage-todos.md:
   - Sequential for prioritization
5. Ensure consistent thinking pattern across all workflows
</task>

<files>
workflows/map-codebase.md
workflows/check-health.md
workflows/yolo-mode.md
workflows/manage-todos.md
</files>

<acceptance>
- All workflows have thinking
- Consistent pattern applied
- Appropriate servers used
</acceptance>
```

### Task 7: Create Workflow Thinking Validator
```
<task>
Create a validator to ensure all workflows have proper thinking phases.

1. Create lib/workflow-thinking/validator.js
2. Implement validate(workflowPath) function:
   - Check for thinking_phase sections
   - Validate thinking server references
   - Check timeout values are reasonable
   - Verify pre/post phases are balanced
3. Add to gsi verify-work command
4. Create report format
5. Add to CI/CD if applicable
</task>

<files>
lib/workflow-thinking/validator.js
</files>

<acceptance>
- Validator created
- All checks implemented
- Integrated with verify-work
- Report format defined
</acceptance>
```

## Verification

**Must Have:**
- [ ] All workflows have thinking phases
- [ ] Pre/post workflow thinking
- [ ] Step-level thinking
- [ ] Reflection captured in debug-thinking
- [ ] Validator enforces thinking presence

**Nice to Have:**
- [ ] Thinking phase templates
- [ ] Workflow thinking metrics
- [ ] Best practices documentation

## Estimated Duration
20-25 minutes (7 tasks with 30 workflow files)

## Dependencies
- Phase 20-01 (Hook Registration) - hooks registered
- Phase 20-02 (PreToolUse Thinking) - thinking infrastructure
- Phase 20-03 (PostToolUse Reflection) - reflection capture
- Phase 2 (Workflow Integration) - workflows exist
