---
phase: 34
plan: 04
title: Quality Gates
wave: 2
depends_on: [34-03]
files_modified:
  - .github/workflows/quality.yml
  - scripts/quality-check.sh
autonomous: true
must_haves:
  truths:
    - Code quality enforced
    - Linting passes
    - Type checking passes
  artifacts:
    - .github/workflows/quality.yml:60
    - scripts/quality-check.sh:40
---

# 34-04: Quality Gates

## Objective
Implement quality gates for code quality enforcement.

## Tasks

### Task 1: Quality Workflow
**File**: `.github/workflows/quality.yml`
**Lines**: ~60

```yaml
name: Quality Gates

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Run ESLint
        run: npm run lint

      - name: Run Prettier check
        run: npm run format:check

  typecheck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20
          cache: 'npm'

      - name: Install dependencies
        run: npm ci

      - name: Type check
        run: npm run typecheck

  security:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies
        run: npm ci

      - name: Run audit
        run: npm audit --audit-level=moderate

      - name: Run Snyk
        uses: snyk/actions/node@master
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
```

### Task 2: Quality Check Script
**File**: `scripts/quality-check.sh`
**Lines**: ~40

```bash
#!/bin/bash
set -e

echo "Running quality gates..."

# Linting
echo "→ ESLint"
npm run lint

# Formatting
echo "→ Prettier"
npm run format:check

# Type checking
echo "→ TypeScript"
npm run typecheck

# Security audit
echo "→ npm audit"
npm audit --audit-level=moderate || true

# Unused dependencies
echo "→ Knip (unused exports)"
npx knip

# Circular dependencies
echo "→ Madge (circular deps)"
npx madge --circular src/

echo "✅ All quality gates passed!"
```

## Output
- Quality gates workflow
- Comprehensive quality check script
- Security scanning

**Next**: 34-05 - Deployment Pipeline
