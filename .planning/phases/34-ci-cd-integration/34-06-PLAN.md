---
phase: 34
plan: 06
title: Monitoring Integration
wave: 3
depends_on: [34-05]
files_modified:
  - .github/workflows/monitor.yml
  - scripts/health-check.ts
autonomous: true
must_haves:
  truths:
    - Health monitored
    - Alerts configured
    - Metrics collected
  artifacts:
    - .github/workflows/monitor.yml:60
    - scripts/health-check.ts:80
---

# 34-06: Monitoring Integration

## Objective
Set up monitoring and health checks for GSI.

## Tasks

### Task 1: Monitoring Workflow
**File**: `.github/workflows/monitor.yml`
**Lines**: ~60

```yaml
name: Monitoring

on:
  schedule:
    # Run every 6 hours
    - cron: '0 */6 * * *'
  workflow_dispatch:

jobs:
  health-check:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 20

      - name: Install dependencies
        run: npm ci

      - name: Run health check
        run: npx ts-node scripts/health-check.ts

      - name: Report status
        if: failure()
        uses: discord/webhook@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK }}
          message: "⚠️ GSI health check failed"

  metrics:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Collect metrics
        run: |
          echo "Collecting metrics..."
          # Bundle size
          SIZE=$(stat -c%s dist/index.mjs 2>/dev/null || echo "0")
          echo "bundle_size=$SIZE" >> $GITHUB_OUTPUT

          # Test coverage
          COVERAGE=$(cat coverage/coverage-summary.json 2>/dev/null | jq '.total.lines.pct' || echo "0")
          echo "test_coverage=$COVERAGE" >> $GITHUB_OUTPUT

      - name: Upload metrics
        uses: actions/upload-artifact@v4
        with:
          name: metrics
          path: metrics.json
```

### Task 2: Health Check Script
**File**: `scripts/health-check.ts`
**Lines**: ~80

```typescript
import { execSync } from 'child_process';

interface HealthCheck {
  name: string;
  check: () => boolean;
  fix?: () => void;
}

const checks: HealthCheck[] = [
  {
    name: 'TypeScript compilation',
    check: () => {
      try {
        execSync('npx tsc --noEmit', { stdio: 'pipe' });
        return true;
      } catch {
        return false;
      }
    }
  },
  {
    name: 'ESLint passes',
    check: () => {
      try {
        execSync('npm run lint', { stdio: 'pipe' });
        return true;
      } catch {
        return false;
      }
    }
  },
  {
    name: 'Tests pass',
    check: () => {
      try {
        execSync('npm test', { stdio: 'pipe' });
        return true;
      } catch {
        return false;
      }
    }
  },
  {
    name: 'No security vulnerabilities',
    check: () => {
      try {
        execSync('npm audit --audit-level=high', { stdio: 'pipe' });
        return true;
      } catch {
        return false;
      }
    }
  }
];

async function runHealthChecks(): Promise<void> {
  console.log('Running GSI health checks...\n');

  let passed = 0;
  let failed = 0;

  for (const check of checks) {
    process.stdout.write(`→ ${check.name}... `);
    try {
      if (check.check()) {
        console.log('✅');
        passed++;
      } else {
        console.log('❌');
        failed++;
      }
    } catch (error) {
      console.log('❌', error);
      failed++;
    }
  }

  console.log(`\nResults: ${passed} passed, ${failed} failed`);

  if (failed > 0) {
    process.exit(1);
  }
}

runHealthChecks();
```

## Output
- Periodic health monitoring
- Metrics collection
- Alert notifications

**Phase 34 Complete**
